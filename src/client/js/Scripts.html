<!--This file is for client-side Javascript functions that need HTML (like DOM manipulation)
Scriptlets are used a lot here for 'communication' with the server.
It seems like a bit of the mess, and that is because server side and client side synchronization
is very weird with Google scripts.-->
<noscript>
<div id="name">No Javascript :(</div><br><div>This website needs Javascript. Please re-enable it.</div>
</noscript>
<!-- Define functions -->
<script>

//when school starts
var startTime = getTime(new Date(2016,1,1,9,30,0,0));
//when school ends
var endTime = getTime(new Date(2016,1,1,16,30,0,0));

/**
*Types of embedded schedules.Make sure to never change these values.
*@enum {number}
*@readonly
*/
var EMBED_TYPE = {
  ALL:0,
  MOD: 1,
  TIME: 2,
  KEY: 3,
}


//this variable is to stop it from making redudent calculations (only updates html when it is acutally changing something)
var currentview ='';
//the decoder is to replace text entities with their corresponding letter (for example &amp with &)
var decoder = document.createElement('textarea');

const defaultTooltip="No cell highlighted.";

function getFriendlyKeyName(key){
 var splitKeys = key.split('&');
  var out = '';
  for(var i =0;i<splitKeys.length;i++){
    if(splitKeys[i].substring(0,1)=='~')out+='not ';
    out+= splitKeys[i].substring(splitKeys[i].indexOf(':')+1).replace('-',' - ');
    if(i!=splitKeys.length-1)out+=' & ';
  }
  return out;
}

function getTime(date) {
    // Only check for current day
    return (date.getHours() * 60) + date.getMinutes();
}


function addZero(i) {
    // Add a leading zero if the number is a single digit
    if (i < 10) {
        // Implicit cast
        i = "0" + i;
    }
    return i;
}

function getFullModName(name) {
    for (var i = 0; i < modnames.length; i++) {
        if (modnames[i][0] == name) {
          return modnames[i][1];
        }
    }
  return '<i> Unknown mod</i>';
}

function getModColor(name) {
    for (var i = 0; i < modnames.length; i++) {
        if (modnames[i][0] == name) {
          return modcolors[i][0];
        }
    }
  return '#FFF';
}

//don't even try understanding this. I basically wrote a O(n) algorithim to parse the schedule. It is extremely complicated.
function getSchedule(person) {
    var day = <?= day;?>;
    if(day<0||day>=5){
      return 'There is no school today.';
    }
    var row = -1;
    var out = '';
    // Current represents where the person is currently
    var current = '<b>Currently before school</b>';;
    var next = '';
    
    var currenttime = getTime(new Date());
    
               
    var passingPeriod = getCookie('passPeriod');
    if(!passingPeriod||passingPeriod=='')passingPeriod=5;

    // I have no idea what's going on here - Jason
    // Me neither. It just works, so I don't touch it. - Liav
    // Check every time
    for (var i = 0; i<<?=DIMENSIONS.SCHEDULE_WIDTH;?>; i++) {
        if (times[0][i]) {
            // Iff it is a criteria key
            if (times[0][i] == 'KEY') {
                // Check all the mod names
                for (var y = 0; y < <?=DIMENSIONS.SCHEDULE_HEIGHT?>-1; y++) {
                    if (mods[y][i] != 'NULL' || mods[y][i]) {
                        //check key type
                        if(checkKey(person,mods[y][i])){
                          row=y;
                          break;
                        }
                    }
                }
            } else {
              if(row>=0){
                // Check actual times
                var d = new Date(times[0][i]);
                var hours = parseInt(d.getHours());
                if (hours > 12) {
                    // Convert to AM/PM from military time
                    hours -= 12;
                }
                // Add new time to output
                out += hours + ':' + addZero(d.getMinutes());
                // Current time
                if (currenttime >= getTime(d)&&row>=0) {
                    // Get display name of current class
                  var modname = getFullModName(mods[row][i]);
                  if(!modname)modname='Unknown mod';
                    current = '<b>Currently at - ' + modname + '</b>';
                    
                    var nextTime;
                    if(i+1<<?=DIMENSIONS.SCHEDULE_WIDTH;?>)nextTime = getTime(new Date(times[0][i+1]));
                    else nextTime = 9999;
                    
                    var timeDifference = (currenttime-nextTime);
                    
                    if (typeof getFullModName(mods[row][i + 1]) == 'undefined'||nextTime==9999) {
                        // Since the next mod is undefined, we can safely assume that school is over
                        if(Math.abs(timeDifference)==passingPeriod&&timeDifference<0)showNotification('School ends in '+passingPeriod+' minutes.','Get ready to leave.');
                        next = '<b>Next - End of school in '+(Math.abs(timeDifference))+' minute'+Math.abs(timeDifference)!=1 ? 's' : ''+ ' </b>';
                    } else {
                        if(Math.abs(timeDifference)==passingPeriod&&timeDifference<0)showNotification(getFullModName(mods[row][i +1])+' in '+passingPeriod+' minutes.','Wait for your teacher to dismiss you.');
                        // Get the next class
                        next = '<b>Next - ' + getFullModName(mods[row][i +1]) + ' in '+(Math.abs(timeDifference))+' minute'+(Math.abs(timeDifference)!=1 ? 's' : '')+'</b>';
                    }
                }
                var modname = mods[row][i];
                if(!modname)modname='<i>Unknown mod</i>';
              out+='&' + mods[row][i]+';';
              }
            }
        }
    }
    if(row<0){
      return 'Oops! Your personalized schedule wasn\'t found!';
    }
    
    //show when school starts
    if(currenttime>=startTime-passingPeriod&&currenttime<passingPeriod-1){
        showNotification('School starts in 5 minutes.','Be sure to check your first mod!');
    }
    
    if(currenttime>=endTime){
      current = 'School is over.';
      next = '';
    }
    
    var outHTML = '';
    out = out.split(';');
    for (var i =0; i < out.length; i++) {
        if (out[i]) {
            var currentrow = out[i].split('&');
            outHTML += currentrow[0] + ' - ' + getFullModName(currentrow[1]) + '<br>';
        }
    }

    outHTML += '<br>' + current;
    outHTML += '<br>' + next;
    return outHTML;
}

    // Embed the schedule spreadsheet into the page
function embedSchedule(embedtype, term, times, mods, modnames, modcolor, day) {
    if (!embedtype) {
        embedtype = EMBED_TYPE.ALL;
    }
    var out = '<div class="noanimation"id="schedule"><table><tr>';
    var color = '';
    var key = '';
    var disabled=false;
        
    for (var i = 0; i < times[0].length; i++) {
        disabled=false;
        if (times[0][i]) {
            if (times[0][i] == 'KEY') {
                out += '<td id="empty cell"bgcolor="#888"width=6% style="background-color:rgba(0,0,0,0) !important;"></th>';
            } else {
                var time = new Date(times[0][i]);
                var hours = parseInt(time.getHours());
                if (hours > 12) {
                    // Convert to AM/PM from military time
                    hours -= 12;
                }
                color = '#AAA';
                var outtitle = hours + ':' + addZero(time.getMinutes());
                if (embedtype.toString() == EMBED_TYPE.TIME.toString()) {
                    if (outtitle.toUpperCase() != term.toUpperCase()) {
                        disabled=true;
                    } else {
                        color = '#AAA';
                    }
                }else if (embedtype.toString() != EMBED_TYPE.ALL.toString()) {
                    disabled=true;
                }
                var modClass = 'time cell';
                if(disabled)modClass+=' disabled';
                out += '<td class="'+modClass+'"bgcolor="' + color + '"width=6%>' + outtitle + '</th>';
            }
        }
    }
    out += '</tr>';
    
    var width = 0;
    var height = 0;
    
    for (var y = 0; y < mods.length; y++){
      if(mods[y]){
        for(var x = 0; x < mods[y].length; x++){
          if(mods[y][x]){
             if(y>height)height=y;
             if(x>width)width=x;
          }
        }
      }
    }
    
    for (var y = 0; y < mods.length; y++) {
        disabled=false;
        out += '<tr>';
        if (mods[y]) {
            for (var x = 0; x < mods[y].length; x++) {
                disabled=false;
                if (mods[y][x]) {
                    var modname = mods[y][x];
                    var color;
                    var modClass = 'mod cell';
                    if (!times[0][x] || times[0][x] == 'KEY') {
                        modname = getFriendlyKeyName(modname);
                        key = modname;
                        modClass = 'key cell';
                        color = "#AAA";
                        if (embedtype.toString() == EMBED_TYPE.MOD.toString() || embedtype.toString() == EMBED_TYPE.TIME.toString()) {
                              disabled=true;
                        } else if (embedtype.toString() == EMBED_TYPE.KEY.toString()) {
                            if (key.toUpperCase() != term.toUpperCase()) {
                              disabled=true;
                            }
                        }
                    } else {
                        modname = getFullModName(modname,modnames);
                        color = getModColor(mods[y][x],modnames,modcolor);
                        if (!modname) {
                            modname = '<i>' + modname + ' is not a valid mod</i>';
                        }
                        if (embedtype.toString() == EMBED_TYPE.MOD.toString()) {
                            if (modname.toUpperCase() != term.toUpperCase()) {
                                  disabled=true;
                            }
                        } else if (embedtype.toString() == EMBED_TYPE.KEY.toString()) {
                            if (key.toUpperCase() != term.toUpperCase()) {
                                  disabled=true;
                            }
                        } else if (embedtype.toString() == EMBED_TYPE.TIME.toString()) {
                            var date = new Date(times[0][x]);
                            var timetitle = (date.getHours() > 12 ? date.getHours() - 12 : date.getHours()) + ':' + addZero(date.getMinutes());
                            if (timetitle != term) {
                                  disabled=true;
                            }
                        }
                    }
                    if (disabled) {
                        modClass += ' disabled';
                    }
                    out += '<td class="' + modClass + '"bgcolor="' + color + '">' + modname + '</td>';
                }else if(x<width&&x!=0&&y<=height){
                  out+='<td class="empty cell"></td>';
                }
            }
        }
        out += '</tr>';
    }
    out += '</tr></table></div>';
    return out;
}

function embedDynamicSchedule(elem,type,times,mods,modnames,modcolors){
  var key = decoder.value;
  if(elem){
    decoder.innerHTML = elem.innerHTML;
    key =decoder.value
  }else{
    key=null;
  }
  result = embedSchedule(type,key,times,mods,modnames,modcolors);
  if(currentview!=key){
    var schedule = document.getElementById('schedule');
    schedule.outerHTML=result;
    currentview = key;
    if(!key){
      setTooltip(defaultTooltip);
    }else{
      setTooltip("Highlighting "+key+". Press the top-left cell to unhighlight.");
    }
    addDynamicSchedule();
  }

}

var times = <?!=clone(times);?>;
var mods = <?!=clone(mods);?>;
var modnames = <?!=clone(modnames);?>;
var modcolors = <?!=clone(modcolors);?>;
var peoplenames = <?!=clone(peoplenames);?>;

//for the dynamic schedule where it displays what you are hovering over.
function addDynamicSchedule(){
  var schedule = document.getElementById('schedule');
if(schedule){
var keys = document.getElementsByClassName('key');
var modcells = document.getElementsByClassName('mod');
var empties = document.getElementsByClassName('empty');
var timecells = document.getElementsByClassName('time');
if(times&&mods&&modnames&&modcolors){
for(var i =0;i<keys.length;i++){
var elem = keys[i];
//console.log(keys[i]+' '+i+' '+elem.innerHTML);
elem.onmousedown=function(event){
if(event.stopPropagation){
event.stopPropagation();
}else{
//freaking ie
event.cancelBubble=true;
}
embedDynamicSchedule(event.toElement,EMBED_TYPE.KEY,times,mods,modnames,modcolors);};//
}
for(var i =0;i<modcells.length;i++){
var elem = modcells[i];
//console.log(keys[i]+' '+i+' '+elem.innerHTML);
elem.onmousedown=function(event){
if(event.stopPropagation){
event.stopPropagation();
}else{
//freaking ie
event.cancelBubble=true;
}
embedDynamicSchedule(event.toElement,EMBED_TYPE.MOD,times,mods,modnames,modcolors);};//
}
for(var i =0;i<timecells.length;i++){
var elem = timecells[i];
//console.log(keys[i]+' '+i+' '+elem.innerHTML);
elem.onmousedown=function(event){
if(event.stopPropagation){
event.stopPropagation();
}else{
//freaking ie
event.cancelBubble=true;
}
embedDynamicSchedule(event.toElement,EMBED_TYPE.TIME,times,mods,modnames,modcolors);};//
}
schedule.onmousedown=function(event){embedDynamicSchedule(event.toElement,EMBED_TYPE.ALL,times,mods,modnames,modcolors);};
}}
}


function addModSelector(){
var schedule = document.getElementById('schedule');
if(schedule){
var keys = document.getElementsByClassName('key');
var modcells = document.getElementsByClassName('mod');
var empties = document.getElementsByClassName('empty');
var timecells = document.getElementsByClassName('time');

for(var i =0;i<modcells.length;i++){
var elem = modcells[i];
addModReference(elem);
}
}
}

function decode(name){
decoder.innerHTML = name;
return decoder.value;
}

function addModReference(elem){
var attributes = '<?!= getCurrentAttribute(); ?>';
var mod = elem.innerHTML;
var form = '<form class="'+mod+'"action="<?=getURL();?>"><?!= getCurrentAttribute(); ?><input type="hidden"name="view"value="10"/><input type="hidden"name="mod"value="'+mod+'"/></form>';
elem.innerHTML = mod+form;
elem.onmousedown=function(){console.log(mod);document.getElementsByClassName(decode(mod))[0].submit();};
}

function setTooltip(text){
var tooltip = $("#schedule-tooltip");
if(!tooltip.length){
  $("#schedule").after("<i id='schedule-tooltip'></i>");
  tooltip = $("#schedule-tooltip");
}
tooltip.text(text);
}


/*! modernizr 3.3.1 (Custom Build) | MIT *
 * https://modernizr.com/download/?-touchevents-mq-setclasses !*/
!function(e,n,t){function o(e,n){return typeof e===n}function s(){var e,n,t,s,a,i,r;for(var l in c)if(c.hasOwnProperty(l)){if(e=[],n=c[l],n.name&&(e.push(n.name.toLowerCase()),n.options&&n.options.aliases&&n.options.aliases.length))for(t=0;t<n.options.aliases.length;t++)e.push(n.options.aliases[t].toLowerCase());for(s=o(n.fn,"function")?n.fn():n.fn,a=0;a<e.length;a++)i=e[a],r=i.split("."),1===r.length?Modernizr[r[0]]=s:(!Modernizr[r[0]]||Modernizr[r[0]]instanceof Boolean||(Modernizr[r[0]]=new Boolean(Modernizr[r[0]])),Modernizr[r[0]][r[1]]=s),f.push((s?"":"no-")+r.join("-"))}}function a(e){var n=d.className,t=Modernizr._config.classPrefix||"";if(p&&(n=n.baseVal),Modernizr._config.enableJSClass){var o=new RegExp("(^|\\s)"+t+"no-js(\\s|$)");n=n.replace(o,"$1"+t+"js$2")}Modernizr._config.enableClasses&&(n+=" "+t+e.join(" "+t),p?d.className.baseVal=n:d.className=n)}function i(){return"function"!=typeof n.createElement?n.createElement(arguments[0]):p?n.createElementNS.call(n,"http://www.w3.org/2000/svg",arguments[0]):n.createElement.apply(n,arguments)}function r(){var e=n.body;return e||(e=i(p?"svg":"body"),e.fake=!0),e}function l(e,t,o,s){var a,l,f,c,u="modernizr",p=i("div"),m=r();if(parseInt(o,10))for(;o--;)f=i("div"),f.id=s?s[o]:u+(o+1),p.appendChild(f);return a=i("style"),a.type="text/css",a.id="s"+u,(m.fake?m:p).appendChild(a),m.appendChild(p),a.styleSheet?a.styleSheet.cssText=e:a.appendChild(n.createTextNode(e)),p.id=u,m.fake&&(m.style.background="",m.style.overflow="hidden",c=d.style.overflow,d.style.overflow="hidden",d.appendChild(m)),l=t(p,e),m.fake?(m.parentNode.removeChild(m),d.style.overflow=c,d.offsetHeight):p.parentNode.removeChild(p),!!l}var f=[],c=[],u={_version:"3.3.1",_config:{classPrefix:"",enableClasses:!0,enableJSClass:!0,usePrefixes:!0},_q:[],on:function(e,n){var t=this;setTimeout(function(){n(t[e])},0)},addTest:function(e,n,t){c.push({name:e,fn:n,options:t})},addAsyncTest:function(e){c.push({name:null,fn:e})}},Modernizr=function(){};Modernizr.prototype=u,Modernizr=new Modernizr;var d=n.documentElement,p="svg"===d.nodeName.toLowerCase(),m=u._config.usePrefixes?" -webkit- -moz- -o- -ms- ".split(" "):["",""];u._prefixes=m;var h=u.testStyles=l;Modernizr.addTest("touchevents",function(){var t;if("ontouchstart"in e||e.DocumentTouch&&n instanceof DocumentTouch)t=!0;else{var o=["@media (",m.join("touch-enabled),("),"heartz",")","{#modernizr{top:9px;position:absolute}}"].join("");h(o,function(e){t=9===e.offsetTop})}return t});var v=function(){var n=e.matchMedia||e.msMatchMedia;return n?function(e){var t=n(e);return t&&t.matches||!1}:function(n){var t=!1;return l("@media "+n+" { #modernizr { position: absolute; } }",function(n){t="absolute"==(e.getComputedStyle?e.getComputedStyle(n,null):n.currentStyle).position}),t}}();u.mq=v,s(),a(f),delete u.addTest,delete u.addAsyncTest;for(var g=0;g<Modernizr._q.length;g++)Modernizr._q[g]();e.Modernizr=Modernizr}(window,document);

function setTouchScreen(touch){
  calculateInfoButtonWidth(touch);
  if(touch){
    const style = "<?!=includeMultiline('Mobile.html');?>";
    $("head").append(style);
  }else{
  }
}

function getTextWidth(text, font) {
    // re-use canvas object for better performance
    var canvas = getTextWidth.canvas || (getTextWidth.canvas = document.createElement("canvas"));
    var context = canvas.getContext("2d");
    context.font = font;
    var metrics = context.measureText(text);
    return metrics.width;
}

//size of the background image in the infobutton in px
var INFOBUTTON_IMAGE_SIZE = 70;


function calculateInfoButtonWidth(touch){
  var infobuttons=$('.infobutton');

  var enlarge = function(index){
    var element = $(this);
    var text = element.val();
    var font = element.css("font");
    
    //70 is the size of the icon
    element.css("width",(INFOBUTTON_IMAGE_SIZE+getTextWidth(text,font)+"px"));
  };
  
  var defaultSize = function(index){
      var element = $(this);
      element.css("width",INFOBUTTON_IMAGE_SIZE+"px");
  };
    
  if(!touch){
    defaultSize();
    infobuttons.hover(enlarge,defaultSize);
  }else{
    //if its a touch screen, we dont want special hover effects
    infobuttons.each(enlarge);
  }
  
}

function setCookie(cname, cvalue, exdays) {
    var expires = "";
    if(!exdays)exdays = 365;
    
    var d = new Date();
    d.setTime(d.getTime() + (exdays*24*60*60*1000));
    expires = "expires="+d.toGMTString();
    document.cookie = cname + "=" + cvalue + "; " + expires;
}

function getCookie(cname) {
    if(!document&&!document.cookie)return "";
    var name = cname + "=";
    var ca = document.cookie.split(';');
    for(var i = 0; i < ca.length; i++) {
        var c = ca[i];
        while (c.charAt(0) == ' ') {
            c = c.substring(1);
        }
        if (c.indexOf(name) == 0) {
            return c.substring(name.length, c.length);
        }
    }
    return "";
}

function stopLoading(){
  var body = $('body');
  body.css('visibility','visible');
  $('#loading').remove();
  
  //we dont want the page to spaz out as all the transitions trigger... so using some black magic, we disable transitions, flush the css, and then renable them.
  body.toggleClass('notransition');
  body[0].offsetHeight;//trigger a flush. this works... somehow.
  $('#main-stylesheet').append('*{transition: all 0.3s ease 0s;}');
  body.toggleClass('notransition');
 }

function showNotification(title,body,icon,onclick){
  if(getCookie('notify')){
    if(!onclick)onclick = function(){};
    if(!icon){
        //woah woah wikipedia? the academy website doesnt have a version of the logo hosted with https (which will invalidate the security certificate.) Wikipedia, however, does have one for the page. Thanks Obama.
       icon = 'https://upload.wikimedia.org/wikipedia/en/c/c7/PlanoAcademyHSLogo.jpg';

    }
  
    var notification = new Notification(title, {
    icon: icon,
    body: body,
    });
    
    notification.onclick = onclick;
  }
}

function createTimers(){
  createNotifications();
  
  window.setInterval(function(){
    //console.log(times);
    
    if(personID&&personID!=-1){
      refreshPersonalizedSchedule(personID);
    }
    },60000);
}

function createNotifications(){
  document.addEventListener('DOMContentLoaded', function () {
  if(!getCookie('notify')){
    if (!Notification) {
      setCookie('notify','false');
      return;
    }
  
    if (Notification.permission !== "granted")
    Notification.requestPermission();
      setCookie('notify','true');
      }
      setCookie('passPeriod',5);
  });
}

var personalizedSchedule = $('#personalized-schedule');

function refreshPersonalizedSchedule(personID){
  personalizedSchedule.empty().html(getSchedule(personID));
}

var personID = -1;

function execute(){
createTimers();

setTouchScreen(Modernizr.touch||Modernizr.mq('only all and (max-device-width: 800px)')||('ontouchstart' in document.documentElement));

applyTheme(getCookie('theme'));

addDynamicSchedule();

var schedule = $('#schedule');
if(schedule.length){
  //if the hook exists, then we set it to be the default show-all schedule
  embedDynamicSchedule(schedule,EMBED_TYPE.ALL,times,mods,modnames,modcolors);//
}

setTooltip(defaultTooltip);

<?if(view&&(view.toString()==VIEW_TYPE.PERSONALIZED_SCHEDULE.toString()||view.toString()==VIEW_TYPE.LEARNER_SCHEDULE.toString())) {?>
personID = <?!= findPersonByName(getParameterByName('first',query),getParameterByName('last',query));?>;
<? } else if(view&&view.toString()==VIEW_TYPE.GROUP_SCHEDULE.toString()){?>
personID = <?!= findGroup(getParameterByName('group',query));?>;
<?} else{?>
personID = -1;
<? }?>
if(personID&&personID!=-1){
  refreshPersonalizedSchedule(personID);
}

}


//settings
var hook;

//defining the possible options
var days = ['Monday','Tuesday','Wednesday','Thursday','Friday'];//this is index based
var styles = [['','Normal','The standard theme.',false],
['dark','Dark','Same as the normal theme, except recolored to save energy and be better on your eyes',false],
['simple','Fast','Special theme that sacrifices appearance for performance.',false],
['enhanced','Enhanced (Beta)','A brand new design, now available for testing!',false],
['aprilfools','Hardy,hardie,hardy meme,hardy memes,michael,micheal,michael hardy,michael hardy,physkiks,not bailey','A meme theme based on <a href="https://www.reddit.com/r/hardymemes">Hardy Memes.</a>',true],
['omega','Omega,ohm,om,ohmega,omega herobrine,herobrine,ohmega herobrine,minecraft,noscopes,entertainment','<a href="https://www.youtube.com/channel/UCdfiEmOyIt6BHPZms6Nv1wQ">A theme to celebrate the best youtube channel ever!</a>',true],
['meme','Meme,memes,maymay,maymays,not hardy memes,normal meme,normal memes,rainbow','Maymay the memes bebe with meme.',true],
['bailey','Bailey,bailie,bails,bailsey,brad,bradley,bradly,brad bailey,b bailey,bradley bailey,bradly bailey,not hardy','Go to work and pay the bails',true],
['wizer','Wizer,wizor,senor,spanish,over 20,sunor,senor wizer,senor wizor,none the wizer,none the wizor','"Anyone above 20 is too uncool"',true],
['laggy','Laggy,lag,spinny,epilepsy,seizure,the end,chaos,no return,the point of no return,wontfix,chromebook,chrome,call of duty,cod,ea games','Embrace the chaos',true],
['frog','Pepe,frog,le pepe,normie,le frog,4chan,hacker 4chan,sad,toad,sad frog,rare,rare meme,rare memes,rare pepe,rare frog,not common','How rare!',true],
['neel','Neel,bernie,tesla,spacex,elon musk,pi,pai,neilish,kneel,3.14,3.1459','Bernie Sanders',true],
['harambe','Harambe,harambe,gorilla','Harambe',true],
];//the first element of the nested array is the stylesheet name, while the second is a list of terms to describe it. The first word is the name that appears to the user. The third is a description. Fourth is if its hidden or not

function applyTheme(theme){
  if(theme==''){
     stopLoading();
  }else{
    console.log('Current theme: '+theme);
    google.script.run.withSuccessHandler(function(result){
      $('head').append(result);
      stopLoading();
    }).include(theme);
  }
}

function close(){
$("#settings").stop(true,true).css("width","0%");
//why arent i using fadeout()? because it jitters for some reason. this way is faster, but a bit messier.
$("#shade").css("display","none");
}

//create the description for the currently selected theme. takes in <select> object which controls style.
function addThemeDescription(object){
  var desc = $("#settings-style-description");
  var selectedValue = $(object).val();
    for(var i =0;i<styles.length;i++){
      if(styles[i][0]==selectedValue){
        desc.html(styles[i][2]);
      }
    }
}

function addHiddenTheme(){
  var value = $('#hidden-selector').val().toLowerCase();
  for(var i = 0;i<styles.length;i++){
    if(styles[i][3]==true){
      var splitNames = styles[i][1].split(',');
      for(var j=0;j<splitNames.length;j++){
        if(splitNames[j].toLowerCase()==value){
            var styleselect = $('#settings-style-selector');
            var option = $('<option value="'+styles[i][0]+'">'+splitNames[0]+'</option>');
            option.appendTo(styleselect);
            alert('Added '+splitNames[0]);
            return;
        }
      }
    }
  }
  alert('That is not a hidden theme.');
}

function addHookClickListener(){
  hook.stop(true,true).unbind().click(function(){
    $("#shade").css("display","inline").css("opacity","0").css("opacity","0.7");
    $("#settings").stop(true,true).css("width","20%");
    });
    
    
    $("#cancel-settings-button").unbind().click(function(){
      close();
    });
    
    var form = $("#settings-form");
    var query = '<?=query;?>'.substring(1).split('&');
    var day = new Date().getDay();
    var style = getCookie('theme');
    for(var i =0;i<query.length;i++){
      var parameter = query[i].split('=');
      //we dont want to add day and style to the output, as the <select> is adding it.
      //Additionally, we store those 2 values so then we can decide the default values for said <select>
      if(parameter[0]=='day'){
        day=parameter[1];
      }else{
        $('<input type="hidden"name="'+parameter[0]+'"value="'+parameter[1]+'"/>').prependTo(form);
      }
    }
    
    var dayselect = $('#settings-day-selector');
    var styleselect = $('#settings-style-selector');
    
    for(var i=0;i<styles.length;i++){//add the style <option>'s
      var current = (styles[i][0]==style);
      if(!styles[i][3]||(current)){
        var select = '<option value="'+styles[i][0]+'"';
        if(styles[i][0]==style){
          select+='selected="selected"id="selected-style"';//make it default
        }
        select+='>'+styles[i][1].split(',')[0]+'</option>';
        $(select).appendTo(styleselect);
      }
    }
    
    addThemeDescription(styleselect);
    
    //code for the theme description
    styleselect.change(
      function(){
          addThemeDescription(this);
          setCookie('theme',styleselect.val());
      }
    );
    
    for(var i =0;i<days.length;i++){
      var select = '<option value="'+(i+1)+'"';
      var selected = ((i+1)==day);//whether the current selected day is this value
      var today = (i==new Date().getDay()-1);//whether the iterated value represents today
      if(selected){
          select+='selected="selected"id="selected-day"';//set it to default
      }
      select +='>'+days[i];
      if(today){
        select+=' (Today)';//mark that it is today
      }
      select+='</option>';
      $(select).appendTo(dayselect);
    }
    
    $("#submit-settings-button").unbind().click(function(){
      var dayval = dayselect.val();
      if(dayval !=  new Date().getDay()){
        $('<input type="hidden"name="day"value="'+dayval+'"/>').appendTo(form);
      }
  });
}
</script>
<?!=include('Queries.html')?>

